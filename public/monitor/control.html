<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>配置 - 网站监控系统</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 576 512'%3E%3Cpath fill='%234a90e2' d='M560 160H160v352h400V160zM128 0C57.3 0 0 57.3 0 128v352c0 70.7 57.3 128 128 128h448c70.7 0 128-57.3 128-128V128c0-70.7-57.3-128-128-128H128zm384 400H160V128h352v352zM240 240l64 96 96-128-72-64-112 144-72-64 136-144z'/%3E%3C/svg%3E" type="image/svg+xml">
    <link rel="stylesheet" href="fontawesome.css">
    <link rel="stylesheet" href="index.css">
    <link rel="stylesheet" href="control.css">
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-chart-line"></i> 监控配置 </h1>
            <div class="user-info">
                <span id="username"></span>
                <button class="change-password-btn" onclick="openChangePasswordModal()"><i class="fas fa-key"></i> 修改密码</button>
                <button class="logout-btn" onclick="logout()"><i class="fas fa-sign-out-alt"></i></button>
            </div>
        </header>

        <div id="message" style="display: none;"></div>

        <div class="systems-container" id="systems-container">
            <!-- 系统卡片将通过JavaScript动态生成 -->
        </div>

        <div class="create-system-section">
            <h2><i class="fas fa-plus-circle"></i> 创建新的系统监控</h2>
            <div id="create-message" style="display: none;"></div>
            <form id="create-system-form" class="create-system-form">
                <div class="form-group">
                    <label for="new-system-name">系统名称</label>
                    <input type="text" id="new-system-name" name="system_name" placeholder="请输入系统名称" required>
                </div>
                <div class="form-group">
                    <label for="new-site-url">系统URL</label>
                    <input type="url" id="new-site-url" name="site_url" placeholder="请输入网站URL" required>
                </div>
                <button type="submit" class="create-btn"><i class="fas fa-plus"></i> 创建</button>
            </form>
        </div>

        <!-- 监控脚本使用说明 -->
        <div class="create-system-section" style="margin-top: 30px;">
            <h2><i class="fas fa-book"></i> 监控脚本使用说明</h2>
            <div style="padding: 20px; background-color: #f8f9fa; border-radius: 8px; margin-top: 20px;">
                <h3 style="margin-top: 0; color: #333;">基本用法</h3>
                <pre style="background-color: #2d2d2d; color: #f8f8f2; padding: 15px; border-radius: 5px; overflow-x: auto; margin: 15px 0;"><code>&lt;script src="&lt;monitor-server-address&gt;/public/pagemonitor.min.js" data-system="系统名称" data-api-key="API密钥"&gt;&lt;/script&gt;</code></pre>
                
                <h3 style="color: #333; margin-top: 25px;">autoInitialize 功能</h3>
                <p>脚本默认会自动初始化监控功能，无需额外配置。如果需要禁用自动初始化，可以使用以下属性：</p>
                <pre style="background-color: #2d2d2d; color: #f8f8f2; padding: 15px; border-radius: 5px; overflow-x: auto; margin: 15px 0;"><code>&lt;script src="&lt;monitor-server-address&gt;/public/pagemonitor.min.js" data-auto-init="false"&gt;&lt;/script&gt;</code></pre>
                
                <h3 style="color: #333; margin-top: 25px;">支持的 data-xxx 属性</h3>
                <ul style="margin: 15px 0; padding-left: 25px;">
                    <li><strong>data-system</strong>: 系统名称（必填）</li>
                    <li><strong>data-api-key</strong>: API密钥（必填）</li>
                    <li><strong>data-api-base-url</strong>: API基础URL（默认：/api）</li>
                    <li><strong>data-is-spa</strong>: 是否为SPA应用（true/false，默认：false）</li>
                    <li><strong>data-is-track-downloads</strong>: 是否跟踪下载（true/false，默认：true）</li>
                    <li><strong>data-max-pending-items</strong>: 最大待处理记录数（默认：50）</li>
                    <li><strong>data-log-level</strong>: 日志级别（debug/info/warn/error，默认：warn）</li>
                    <li><strong>data-custom-events</strong>: 自定义事件配置（JSON格式）</li>
                    <li><strong>data-active-time-threshold</strong>: 活跃时间阈值（秒，默认：600秒） - 用于计算停留时间</li>
                </ul>
                
                <h3 style="color: #333; margin-top: 25px;">自定义事件配置</h3>
                <p>可以通过 data-custom-events 属性配置自定义事件监控：</p>
                <pre style="background-color: #2d2d2d; color: #f8f8f2; padding: 15px; border-radius: 5px; overflow-x: auto; margin: 15px 0;"><code>&lt;script src="&lt;monitor-server-address&gt;/public/pagemonitor.min.js" 
    data-system="系统名称" 
    data-api-key="API密钥" 
    data-custom-events='[
        {
            "selector": ".btn", 
            "eventType": "click", 
            "properties": {
                "category": "button",
                "action": "click",
                "label": "按钮点击"
            }
        },
        {
            "selector": "#login-form", 
            "eventType": "submit", 
            "properties": {
                "category": "form",
                "action": "submit",
                "label": "登录表单提交"
            }
        }
    ]'&gt;&lt;/script&gt;</code></pre>
                
                <p style="margin-top: 15px; color: #666;"><strong>配置说明：</strong></p>
                <ul style="margin: 15px 0; padding-left: 25px; color: #666;">
                    <li><strong>selector</strong>: CSS选择器，用于匹配要监控的元素</li>
                    <li><strong>eventType</strong>: 事件类型（默认：click）</li>
                    <li><strong>properties</strong>: 自定义事件属性，包含：
                        <ul style="margin-top: 5px; padding-left: 20px;">
                            <li>category: 事件类别</li>
                            <li>action: 事件动作</li>
                            <li>label: 事件标签</li>
                        </ul>
                    </li>
                </ul>
                
                <h3 style="color: #333; margin-top: 25px;">手动初始化（当禁用autoInitialize时）</h3>
                <pre style="background-color: #2d2d2d; color: #f8f8f2; padding: 15px; border-radius: 5px; overflow-x: auto; margin: 15px 0;"><code>&lt;script src="&lt;monitor-server-address&gt;/public/pagemonitor.min.js" data-auto-init="false"&gt;&lt;/script&gt;
&lt;script&gt;
    // 等待DOM加载完成
    document.addEventListener('DOMContentLoaded', function() {
        // 创建监控实例
        window.pageMonitorInstance = new PageMonitor({
            system: '系统名称',
            apiKey: 'API密钥',
            isSPA: false,
            isTrackDownloads: true,
            activeTimeThreshold: 600, // 活跃时间阈值（秒） 即10分钟
            customEvents: [
                {
                    selector: '.btn',
                    eventType: 'click',
                    properties: {
                        category: 'button',
                        action: 'click'
                    }
                }
            ]
        });
    });
&lt;/script&gt;</code></pre>
            </div>
        </div>
    </div>
    
    <!-- 修改密码模态窗口 -->
    <div id="password-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-key"></i> 修改密码</h2>
                <button class="close-btn">&times;</button>
            </div>
            <div id="password-message" style="display: none;"></div>
            <form id="password-form" class="password-form">
                <div class="form-group">
                    <label for="current-password">当前密码</label>
                    <input type="password" id="current-password" name="current_password" placeholder="请输入当前密码" required>
                </div>
                <div class="form-group">
                    <label for="new-password">新密码</label>
                    <input type="password" id="new-password" name="new_password" placeholder="请输入新密码" required>
                </div>
                <div class="form-group">
                    <label for="confirm-password">确认新密码</label>
                    <input type="password" id="confirm-password" name="confirm_password" placeholder="请再次输入新密码" required>
                </div>
                <div class="password-form-actions">
                    <button type="button" class="cancel-btn">取消</button>
                    <button type="submit" class="save-btn">保存修改</button>
                </div>
            </form>
        </div>
    </div>

    <script src="control.js"></script>
</body>
</html>