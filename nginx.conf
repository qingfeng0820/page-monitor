events {
    worker_connections 1024;
}

http {
    client_max_body_size 100M;

    upstream monitor {
        server 192.168.1.6:8000;
    }


    server {

        listen 80 default_server;

         location = /monitor {
            # 使用JavaScript重定向，确保端口正确
            add_header Content-Type text/html;
            return 200 '<!DOCTYPE html>
            <html>
            <head>
                <base href="/monitor/">
                <script>
                    // 获取当前页面的完整URL
                    const currentUrl = window.location.href;
                    const targetUrl = currentUrl.endsWith("/") ? currentUrl : currentUrl + "/";
                    if (currentUrl !== targetUrl) {
                        window.location.href = targetUrl;
                    }
                </script>
                <meta http-equiv="refresh" content="0;url=/monitor/">
            </head>
            <body>
                <p>Redirecting... <a href="/monitor/">Click here if not redirected</a></p>
            </body>
            </html>';
        }

	    # monitor API
        location /monitor/ {
            proxy_pass http://monitor/;

            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;

            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_buffering off;
        }
    }
}
